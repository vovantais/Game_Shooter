const BLOCKS_DIV=document.querySelectorAll(".game div"),COUNT_ROW=Math.sqrt(BLOCKS_DIV.length);let PLAEYR_INDEX=Math.round(BLOCKS_DIV.length-COUNT_ROW/2);const INDEX_ENEMY=[23,24,25,26,27,28,29,30,31,32,33,34,35,36,43,44,45,46,47,48,49,50,51,52,53,54,55,56,63,64,65,66,67,68,69,70,71,72,73,74,75,76],KILL_ENEMY=[];let STEP=1,SCORE_COUNT=1;!function(){BLOCKS_DIV[PLAEYR_INDEX].classList.add("player");for(let e of INDEX_ENEMY)BLOCKS_DIV[e].classList.add("enemy")}();const movePlayer=e=>{BLOCKS_DIV[PLAEYR_INDEX].classList.remove("player"),"ArrowLeft"===e.code&&PLAEYR_INDEX>BLOCKS_DIV.length-COUNT_ROW&&PLAEYR_INDEX--,"ArrowRight"===e.code&&PLAEYR_INDEX<BLOCKS_DIV.length-1&&PLAEYR_INDEX++,BLOCKS_DIV[PLAEYR_INDEX].classList.add("player")};function delegirovan(){let e=document.querySelectorAll(".wrapper");for(let t=0;t<e.length;t++)movePlayerArrow(e[t])}function movePlayerArrow(e){e.addEventListener("click",(function(e){BLOCKS_DIV[PLAEYR_INDEX].classList.remove("player"),"fas fa-arrow-alt-circle-left"===e.target.className&&PLAEYR_INDEX>BLOCKS_DIV.length-COUNT_ROW&&PLAEYR_INDEX--,"fas fa-arrow-alt-circle-right"===e.target.className&&PLAEYR_INDEX<BLOCKS_DIV.length-1&&PLAEYR_INDEX++,BLOCKS_DIV[PLAEYR_INDEX].classList.add("player")}))}document.addEventListener("keydown",movePlayer),delegirovan();const moveEnemies=()=>{const e=INDEX_ENEMY[0]%COUNT_ROW==0,t=INDEX_ENEMY[INDEX_ENEMY.length-1]%COUNT_ROW==COUNT_ROW-1;e&&-1===STEP||t&&1===STEP?STEP=COUNT_ROW:STEP===COUNT_ROW&&(STEP=e?1:-1),INDEX_ENEMY.forEach(e=>{BLOCKS_DIV[e].classList.remove("enemy")});for(let e=0;e<INDEX_ENEMY.length;e++)INDEX_ENEMY[e]+=STEP;if(INDEX_ENEMY.forEach((e,t)=>{KILL_ENEMY.includes(t)||BLOCKS_DIV[e].classList.add("enemy")}),BLOCKS_DIV[PLAEYR_INDEX].classList.contains("enemy"))return GameResalt(),void EndGame();for(let e=0;e<INDEX_ENEMY.length;e++)if(INDEX_ENEMY[e]>BLOCKS_DIV.length-COUNT_ROW)return GameResalt(),void EndGame();if(KILL_ENEMY.length===INDEX_ENEMY.length)return GameResalt(),void EndGame();setTimeout(moveEnemies,400)};moveEnemies();const Fire=e=>{if(1===e.which&&e.target.classList.contains("enemy")){let e=PLAEYR_INDEX;const t=()=>{if(BLOCKS_DIV[e].classList.remove("bullet"),e-=COUNT_ROW,BLOCKS_DIV[e].classList.add("bullet"),e<COUNT_ROW)setTimeout(()=>{BLOCKS_DIV[e].classList.remove("bullet")},50);else{if(BLOCKS_DIV[e].classList.contains("enemy")){BLOCKS_DIV[e].classList.remove("bullet"),BLOCKS_DIV[e].classList.remove("enemy");const t=INDEX_ENEMY.indexOf(e);return KILL_ENEMY.push(t),void Score(SCORE_COUNT++)}setTimeout(t,50)}};t()}};function EndGame(){document.removeEventListener("click",Fire),document.removeEventListener("keydown",movePlayer)}function Score(e){document.querySelector(".Score__text").textContent="killed enemies :  "+e}function GameResalt(){const e=document.querySelector(".wrapper"),t=document.createElement("div"),n=document.createElement("div"),E=document.createElement("p"),a=document.createElement("button"),l=document.createElement("button");t.className="Popap",n.className="Popap__Modal",a.className="Play__btn",l.className="Exit__btn",E.className="Popap__Text",a.textContent="play",l.textContent="EXIT",e.append(t),t.append(n),n.append(E),E.append(a,l),KILL_ENEMY.length===INDEX_ENEMY.length?(E.textContent="You WIN.",n.classList.add("active"),E.append(a,l)):(E.textContent="You lose.",E.append(a,l)),a.addEventListener("click",()=>{location.reload()}),l.addEventListener("click",()=>{window.close()})}document.addEventListener("click",Fire);